# sgenomics-scripts

This folder contains the scripts that were used to build the database. The names should be self-explanatory. The newer .js scripts need to be run in a node.js environment, and require certain modules (especially "mysql" and "async") to be installed using npm install. They support multiple processing (using the "async" module), and thus can normally run much more quickly than the older .php scripts. The .sql scripts can be copied and pasted to a phpmyadmin window as is, or executed in MySQL from a command prompt.

The main file of interest is load_effects_for_all_probes.php. This was used to read all the effects from files and write them to the effect table. Because the script takes so long to run, it is set up so that it can be stopped and will restart from the last probe written before it was stopped. It does this by writing the name of the past probe into last_probe_added table. Unfortunately this also means that the data is stored in the stable in the alphabetical order of the probe names, whereas storing it in the sequence order would have been more useful.  While this could be run much more quickly by running on separate asynchronous functions, it is probably not feasible because the effects would be stored in no particular order, and it would be far too slow to even create extra indexes in the first place. However by increasing tokudb_loader_memory_size, tokudb_read_block_size, tokudb_read_buf_size and tokudb_cache_size (all found in /etc/my.cnf.d/tokudb.cnf), it would have been possible to make this script run much more quickly, had we known about these parameters at the time.

Correlations between probes, across individuals, have been pre-calculated, because it is often useful to compare many different correlations and p-values at once, and calculating them "on the fly" might be a problem.  The p-values for correlation vs number of individuals were calculated in Excel, and are stored in the spreadsheet "correlation to p-value.xlsx".

The actual calculation of correlations was done by loadStaticCorrelationsMEM.php, which requires statsFunctions.php. It was noticed some time later that some of the confidence intervals were incorrect, so redoFishersZ.js and redoConfidenceIntervals.js were written to correct these values.
